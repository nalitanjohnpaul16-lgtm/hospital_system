{% extends 'layout.html' %}
{% block content %}
<div class="bg-full bg-full-solid" style="background-image:url('/assets/ZZZZZZZZZZZZZZZZ.jpg')"></div>
<h2 class="glass-title">Accounts</h2>
<div class="form">
  {% if accounts %}
  <ul style="list-style:none; padding-left:0; display:grid; gap:8px;">
    {% for a in accounts %}
    <li
      style="display:flex; gap:10px; align-items:center; justify-content:space-between; border:1px solid #e5e7eb; border-radius:8px; padding:8px 10px;">
      <div style="display:flex; gap:10px; align-items:center;">
        <span style="font-size:18px;">ğŸ‘¤</span>
        <strong>{{ a.username }}</strong>
        {% if a.saved_password %}
        <span title="Password saved" style="color:#16a34a;">ğŸ”’ saved</span>
        {% endif %}
      </div>
      <div style="display:flex; gap:6px; align-items:center;">
        <a class="btn" href="{{ url_for('login', username=a.username) }}">ğŸ” Login</a>
        <form method="post" action="{{ url_for('accounts_save_password') }}" style="display:inline; position:relative;">
          <input type="hidden" name="username" value="{{ a.username }}">
          <div style="position:relative; display:inline-block;">
            <input id="savePw{{ loop.index }}" type="password" name="password" placeholder="Save password"
              style="padding:6px 32px 6px 6px; border:1px solid #e5e7eb; border-radius:6px;">
            <button type="button" id="toggleSavePw{{ loop.index }}"
              style="position:absolute; right:4px; top:50%; transform:translateY(-50%); background:none; border:none; cursor:pointer; font-size:14px; padding:2px 4px;"
              aria-label="Show/Hide password">ğŸ‘</button>
          </div>
          <button class="btn" type="submit" style="color: #000000;">ğŸ’¾ Save</button>
        </form>
        {% if a.saved_password %}
        <form method="post" action="{{ url_for('accounts_clear_password') }}" style="display:inline;">
          <input type="hidden" name="username" value="{{ a.username }}">
          <button class="btn secondary" type="submit">ğŸ§¹ Clear</button>
        </form>
        {% endif %}
        <form method="post" action="{{ url_for('accounts_remove') }}" style="display:inline;"
          onsubmit="return confirm('Remove this account from this device?');">
          <input type="hidden" name="username" value="{{ a.username }}">
          <button class="btn danger" type="submit">ğŸ—‘ï¸ Remove</button>
        </form>
        {% if current_user and (current_user.role|lower == 'admin') %}
        <form method="post" action="{{ url_for('accounts_ban') }}" style="display:inline;"
          onsubmit="return confirm('Are you sure you want to ban this account?');">
          <input type="hidden" name="username" value="{{ a.username }}">
          <button class="btn danger" type="submit">ğŸš« Ban</button>
        </form>
        {% endif %}
      </div>
    </li>
    {% endfor %}
  </ul>
  {% else %}
  <p>No saved accounts yet.</p>
  {% endif %}
</div>
<script>
  (function () {
    {% for a in accounts %}
    (function () {
      const f = document.getElementById('savePw{{ loop.index }}');
      const t = document.getElementById('toggleSavePw{{ loop.index }}');
      if (f && t) {
        t.addEventListener('mousedown', e => e.preventDefault());
        t.addEventListener('click', () => { const s = f.type === 'password'; f.type = s ? 'text' : 'password'; t.textContent = s ? 'ğŸ™ˆ' : 'ğŸ‘'; });
      }
    })();
    {% endfor %}
  })();
</script>
{% endblock %}