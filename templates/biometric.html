{% extends 'layout.html' %}
{% block body_class %}auth-bg{% endblock %}
{% block content %}
<section class="login-hero">
  <div class="login-card glass">
    <div class="back-box">
      <a href="{{ request.referrer or url_for('overview') }}" class="back-btn">‚Üê</a>
      <span>Back</span>
    </div>
    <div class="login-header">
      <div class="login-icon">üß¨</div>
      <h2>Biometric Authentication</h2>
      <p class="subtitle">Enroll or verify using an image (demo)</p>
    </div>
    <form method="post" enctype="multipart/form-data" class="login-form">
      <div class="field">
        <label>Upload face/fingerprint image</label>
        <div class="input-with-icon">
          <span>üñºÔ∏è</span>
          <input id="imageInput" name="image" type="file" accept="image/*" required>
        </div>
        <p id="fileName" style="margin-top: 5px; font-size: 0.9em; color: gray;">No file chosen</p>
        <div id="imagePreview" style="margin-top: 10px; display: none;">
          <a id="imageLink" href="#" target="_blank">
            <img id="previewImg" src="#" alt="Selected Image"
              style="max-width: 100%; max-height: 200px; border: 1px solid #ccc;">
          </a>
        </div>
      </div>
      <div class="toolbar" style="margin-top:10px;">
        <button class="btn primary glossy" type="submit" name="action" value="verify">Verify</button>
        {% if not verify_only %}
        <button class="btn success glossy" type="submit" name="action" value="enroll">Enroll</button>
        {% endif %}
      </div>
    </form>
    <div class="login-links" style="margin-top:10px;">
      <a href="{{ url_for('biometric_capture') }}">Use webcam to capture image</a>
    </div>
    <p style="margin-top:8px; font-size: 0.9em;">Demo uses the SHA-256 image hash.</p>
  </div>
</section>
<script>
  const imageInput = document.getElementById('imageInput');
  const fileName = document.getElementById('fileName');
  const imagePreview = document.getElementById('imagePreview');
  const imageLink = document.getElementById('imageLink');
  const previewImg = document.getElementById('previewImg');

  imageInput.addEventListener('change', function (event) {
    const file = event.target.files[0];
    if (file) {
      fileName.textContent = file.name;
      const fileURL = URL.createObjectURL(file);
      imageLink.href = fileURL;
      previewImg.src = fileURL;
      imagePreview.style.display = 'block';
    } else {
      fileName.textContent = 'No file chosen';
      imagePreview.style.display = 'none';
    }
  });
</script>
{% endblock %}