{% extends 'layout.html' %}
{% block body_class %}auth-bg{% endblock %}
{% block content %}
<section class="login-hero">
  <div class="login-card glass">
    <div class="login-header">
      <div class="login-icon">üìù</div>
      <h2>Create your account</h2>
      <p class="subtitle">Join Tech‚ÄëCare securely</p>
    </div>
    <form method="post" class="login-form">
      <div class="field">
        <label>Username</label>
        <div class="input-with-icon"><span class="icon icon-user" aria-hidden="true"></span><input name="username"
            type="text" required placeholder="Choose a username" autocomplete="username"></div>
      </div>
      <div class="field">
        <label>Password</label>
        <div class="input-with-icon"><span class="icon icon-lock" aria-hidden="true"></span><input id="spw"
            name="password" type="password" required placeholder="At least 8 chars, 1 number, 1 capital, 1 symbol"
            autocomplete="new-password" pattern="(?=.*[A-Z])(?=.*[0-9])(?=.*[^A-Za-z0-9]).{8,}"><button type="button"
            id="toggleSpw" class="input-icon-btn" aria-label="Show/Hide password">üëÅ</button></div>
        <div class="auth-note">Must be at least 8 characters including 1 number, 1 capital letter, and 1 symbol.</div>
      </div>
      <div class="field">
        <label>Phone (for MFA)</label>
        <div class="input-with-icon"><span class="icon icon-phone" aria-hidden="true"></span><input id="phone"
            name="phone" type="tel" inputmode="tel" placeholder="+63 9xx xxx xxxx" required autocomplete="tel"></div>
        <div class="auth-note">Default format for Philippines: +63 9xx xxx xxxx. Used for MFA and resets.</div>
      </div>
      <div class="field">
        <label>Email (optional, for MFA via email)</label>
        <div class="input-with-icon"><span class="icon icon-mail" aria-hidden="true"></span><input name="email"
            type="email" placeholder="you@example.com" autocomplete="email"></div>
      </div>
      <div class="field">
        <label>Country</label>
        <select name="country" required>
          <option value="">Select country</option>
          <option>United States</option>
          <option>Canada</option>
          <option>United Kingdom</option>
          <option>Australia</option>
          <option selected>Philippines</option>
          <option>India</option>
          <option>Singapore</option>
          <option>Malaysia</option>
          <option>China</option>
          <option>Japan</option>
          <option>Germany</option>
          <option>France</option>
          <option>Italy</option>
          <option>Spain</option>
          <option>South Africa</option>
          <option>Brazil</option>
          <option>Mexico</option>
          <option>United Arab Emirates</option>
          <option>Saudi Arabia</option>
          <option>Qatar</option>
        </select>
      </div>
      <div class="field">
        <label>Role</label>
        <select name="role" id="role" required>
          <option value="" disabled selected>No role selected</option>
          <option value="asset_manager">Asset Manager</option>
          <option value="auditor">Auditor</option>
          <option value="doctor">Doctor</option>
          <option value="inventory_staff">Inventory Staff</option>
          <option value="it_security">IT Security</option>
          <option value="nurse">Nurse</option>
          <option value="patients">Patients</option>
          <option value="other">Other (view only)</option>
        </select>
      </div>
      <div class="field">
        <p>Already have an account? <a href="/login" class="btn-link">Sign In</a></p>
      </div>
      <div class="field" id="specField" style="display:none;">
        <label>Specialty (Doctors only)</label>
        <select name="specialty" id="specialty">
          <option value="">Select specialty</option>
          <option>Cardiology</option>
          <option>Pediatrics</option>
          <option>General Medicine</option>
          <option>Surgery</option>
          <option>Neurology</option>
          <option>Orthopedics</option>
          <option>Dermatology</option>
          <option>Radiology</option>
          <option>Anesthesiology</option>
          <option>OB-GYN</option>
          <option>Psychiatry</option>
          <option>Other</option>
        </select>
      </div>
      <button type="submit" class="btn primary lg glossy block">Create Account</button>
    </form>
    <div class="login-links" style="margin-top:10px;">
      <a href="{{ url_for('login') }}">Back to Login</a>
    </div>
  </div>
</section>
<script>
  (function () {
    const pw = document.getElementById('spw');
    const btn = document.getElementById('toggleSpw');
    const gen = null;
    const role = document.getElementById('role');
    const specField = document.getElementById('specField');
    const phone = document.getElementById('phone');
    if (pw && btn) {
      btn.addEventListener('mousedown', function (e) { e.preventDefault(); });
      btn.addEventListener('click', function () {
        const show = pw.type === 'password';
        pw.type = show ? 'text' : 'password';
        btn.textContent = show ? 'üôà' : 'üëÅ';
        pw.focus();
      });
    }
    // removed suggest password button per request
    if (role && specField) {
      role.addEventListener('change', function () {
        specField.style.display = (role.value === 'doctor') ? '' : 'none';
      });
    }
    if (phone) {
      // auto-prefix +63 if user enters starting with 0
      phone.addEventListener('blur', function () {
        let v = phone.value.trim();
        if (v && v[0] === '0') {
          v = '+63' + v.slice(1);
          phone.value = v;
        }
      });
    }
  })();
</script>
{% endblock %}