{% extends 'layout.html' %}
{% block body_class %}auth-bg{% endblock %}
{% block content %}
<section class="login-hero">
  <div class="login-card glass">
    <div class="back-box">
      <a href="{{ request.referrer or url_for('login') }}" class="back-btn">
        <- </a>
    </div>
    <h2 style="text-align: center;">New Password</h2>
    <form method="post" class="login-form">
      <div class="field">
        <label>New Password</label>
        <div class="input-with-icon">
          <input id="rpw" name="new_password" type="password"
            placeholder="At least 8 chars, 1 number, 1 capital, 1 symbol" required>
          <button type="button" id="toggleRpw" class="input-icon-btn" aria-label="Show/Hide password">üëÅ</button>
        </div>
        <div class="password-requirements" style="font-size: 12px; color: #6b7280; margin-top: 5px;">
          Password must contain:
          <ul style="margin: 5px 0; padding-left: 20px;">
            <li>At least 8 characters</li>
            <li>At least 1 number</li>
            <li>At least 1 capital letter</li>
            <li>At least 1 symbol (!@#$%^&*(),.?":{}|<>)</li>
          </ul>
        </div>
      </div>
      <button type="submit" class="btn primary lg glossy block">Update Password</button>
    </form>
  </div>
</section>
<script>
  (function () {
    const f = document.getElementById('rpw');
    const t = document.getElementById('toggleRpw');
    if (f && t) {
      t.addEventListener('mousedown', e => e.preventDefault());
      t.addEventListener('click', () => {
        const s = f.type === 'password';
        f.type = s ? 'text' : 'password';
        t.textContent = s ? 'üôà' : 'üëÅ';
        f.focus();
      });
    }

    // Real-time password validation
    if (f) {
      f.addEventListener('input', function () {
        const password = this.value;
        const requirements = document.querySelector('.password-requirements ul');
        if (!requirements) return;

        const items = requirements.querySelectorAll('li');

        // Check length (at least 8 characters)
        items[0].style.color = password.length >= 8 ? '#10b981' : '#ef4444';

        // Check for number
        items[1].style.color = /[0-9]/.test(password) ? '#10b981' : '#ef4444';

        // Check for capital letter
        items[2].style.color = /[A-Z]/.test(password) ? '#10b981' : '#ef4444';

        // Check for symbol
        items[3].style.color = /[!@#$%^&*(),.?":{}|<>]/.test(password) ? '#10b981' : '#ef4444';
      });
    }
  })();
</script>
{% endblock %}