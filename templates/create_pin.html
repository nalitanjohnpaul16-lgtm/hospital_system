{% extends 'layout.html' %}
{% block body_class %}auth-bg{% endblock %}
{% block content %}
<section class="login-hero">
  <div class="login-card glass">
    <div class="back-box">
      <a href="{{ request.referrer or url_for('overview') }}" class="back-btn">
        â†
      </a>
      <span>Back</span>
    </div>
    <div class="login-header">
      <div class="login-icon">ğŸ”’</div>
      <h2>Create Your PIN</h2>
      <p class="subtitle">Set a 4â€“6 digit PIN to protect sensitive actions</p>
    </div>
    <form method="post" class="login-form">
      <div class="field">
        <label>New PIN</label>
        <div class="input-with-icon">
          <input id="newPin" name="pin" type="password" inputmode="numeric" pattern="\d{4,6}" maxlength="6" required
            placeholder="â€¢â€¢â€¢â€¢â€¢">
          <button type="button" id="toggleNewPin" class="input-icon-btn" aria-label="Show/Hide PIN">ğŸ‘</button>
        </div>
      </div>
      <button type="submit" class="btn primary lg glossy block">Save PIN</button>
    </form>
  </div>
</section>
<script>
  (function () {
    const newPinField = document.getElementById('newPin');
    const toggleNewPin = document.getElementById('toggleNewPin');

    if (newPinField && toggleNewPin) {
      // Prevent default mousedown to avoid focus loss
      toggleNewPin.addEventListener('mousedown', e => e.preventDefault());

      // Toggle PIN visibility
      toggleNewPin.addEventListener('click', () => {
        const isPassword = newPinField.type === 'password';
        newPinField.type = isPassword ? 'text' : 'password';
        toggleNewPin.textContent = isPassword ? 'ğŸ™ˆ' : 'ğŸ‘';
        newPinField.focus();
      });

      // Ensure only numeric input for PIN
      newPinField.addEventListener('input', function (e) {
        // Remove any non-numeric characters
        this.value = this.value.replace(/[^0-9]/g, '');

        // Limit to 6 digits
        if (this.value.length > 6) {
          this.value = this.value.slice(0, 6);
        }
      });

      // Auto-submit when 6 digits are entered (optional enhancement)
      newPinField.addEventListener('input', function (e) {
        if (this.value.length === 6) {
          // Optional: Auto-submit form when 6 digits are entered
          // Uncomment the next line if you want auto-submit
          // this.form.submit();
        }
      });
    }
  })();
</script>
{% endblock %}