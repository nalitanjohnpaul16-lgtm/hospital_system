{% extends 'layout.html' %}
{% block content %}
<div class="bg-full bg-full-solid" style="background-image:url('/assets/HMS1.jpg')"></div>
<h2 class="glass-title">My Profile</h2>
<form class="form" method="post" enctype="multipart/form-data">
  <label>Username</label>
  <input type="text" value="{{ user.get('username') }}" disabled>

  {% if user.get('avatar') %}
  <label>Current Avatar</label>
  <img src="{{ user.get('avatar') }}" alt="Avatar"
    style="width:96px; height:96px; border-radius:50%; object-fit:cover; border:1px solid #e5e7eb;">
  {% endif %}

  <label>Upload New Avatar</label>
  <input name="avatar" type="file" accept="image/*">

  <label>Phone</label>
  <input name="phone" type="tel" inputmode="tel" value="{{ user.get('phone','') }}" placeholder="+1xxxxxxxxxx">

  <label>Email</label>
  <input name="email" type="email" value="{{ user.get('email','') }}" placeholder="you@example.com">

  <label>PIN (6 digits; set on first edit)</label>
  <div class="input-with-icon">
    <input id="pinField" name="pin" type="password" inputmode="numeric" maxlength="6" pattern="\d{6}"
      placeholder="Optional change">
    <button type="button" id="togglePinField" class="input-icon-btn" aria-label="Show/Hide PIN">ğŸ‘</button>
  </div>

  <hr style="margin: 20px 0; border: none; border-top: 1px solid #e5e7eb;">

  <h3 style="margin-bottom: 15px; color: #374151;">Change Password</h3>

  <label>Current Password</label>
  <div class="input-with-icon">
    <input id="currentPw" name="current_password" type="password" placeholder="Enter current password">
    <button type="button" id="toggleCurrentPw" class="input-icon-btn"
      aria-label="Show/Hide current password">ğŸ‘</button>
  </div>

  <label>New Password</label>
  <div class="input-with-icon">
    <input id="newPw" name="new_password" type="password" placeholder="At least 8 chars, 1 number, 1 capital, 1 symbol">
    <button type="button" id="toggleNewPw" class="input-icon-btn" aria-label="Show/Hide new password">ğŸ‘</button>
  </div>

  <div class="password-requirements" style="font-size: 12px; color: #6b7280; margin-top: 5px;">
    Password must contain:
    <ul style="margin: 5px 0; padding-left: 20px;">
      <li>At least 8 characters</li>
      <li>At least 1 number</li>
      <li>At least 1 capital letter</li>
      <li>At least 1 symbol (!@#$%^&*(),.?":{}|<>)</li>
    </ul>
  </div>

  <div class="form-actions">
    <button class="btn primary" type="submit">Save</button>
  </div>
</form>

<script>
  (function () {
    // Eye toggle for current password
    const currentPwField = document.getElementById('currentPw');
    const toggleCurrentPw = document.getElementById('toggleCurrentPw');
    if (currentPwField && toggleCurrentPw) {
      toggleCurrentPw.addEventListener('mousedown', e => e.preventDefault());
      toggleCurrentPw.addEventListener('click', () => {
        const isPassword = currentPwField.type === 'password';
        currentPwField.type = isPassword ? 'text' : 'password';
        toggleCurrentPw.textContent = isPassword ? 'ğŸ™ˆ' : 'ğŸ‘';
        currentPwField.focus();
      });
    }

    // Eye toggle for new password
    const newPwField = document.getElementById('newPw');
    const toggleNewPw = document.getElementById('toggleNewPw');
    if (newPwField && toggleNewPw) {
      toggleNewPw.addEventListener('mousedown', e => e.preventDefault());
      toggleNewPw.addEventListener('click', () => {
        const isPassword = newPwField.type === 'password';
        newPwField.type = isPassword ? 'text' : 'password';
        toggleNewPw.textContent = isPassword ? 'ğŸ™ˆ' : 'ğŸ‘';
        newPwField.focus();
      });
    }

    // Eye toggle for PIN field
    const pinField = document.getElementById('pinField');
    const togglePinField = document.getElementById('togglePinField');
    if (pinField && togglePinField) {
      togglePinField.addEventListener('mousedown', e => e.preventDefault());
      togglePinField.addEventListener('click', () => {
        const isPassword = pinField.type === 'password';
        pinField.type = isPassword ? 'text' : 'password';
        togglePinField.textContent = isPassword ? 'ğŸ™ˆ' : 'ğŸ‘';
        pinField.focus();
      });

      // Ensure only numeric input for PIN
      pinField.addEventListener('input', function (e) {
        // Remove any non-numeric characters
        this.value = this.value.replace(/[^0-9]/g, '');

        // Limit to 6 digits for profile PIN
        if (this.value.length > 6) {
          this.value = this.value.slice(0, 6);
        }
      });
    }

    // Real-time password validation
    if (newPwField) {
      newPwField.addEventListener('input', function () {
        const password = this.value;
        const requirements = document.querySelector('.password-requirements ul');
        if (!requirements) return;

        const items = requirements.querySelectorAll('li');

        // Check length (at least 8 characters)
        items[0].style.color = password.length >= 8 ? '#10b981' : '#ef4444';

        // Check for number
        items[1].style.color = /[0-9]/.test(password) ? '#10b981' : '#ef4444';

        // Check for capital letter
        items[2].style.color = /[A-Z]/.test(password) ? '#10b981' : '#ef4444';

        // Check for symbol
        items[3].style.color = /[!@#$%^&*(),.?":{}|<>]/.test(password) ? '#10b981' : '#ef4444';
      });
    }
  })();
</script>
{% endblock %}